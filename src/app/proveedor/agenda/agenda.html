<app-provider-nav></app-provider-nav>
<!-- Contenido Principal -->
<div class="ml-64 min-h-screen bg-slate-50 overflow-y-auto">
<style>
    .calendar-container {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 32px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 32px 24px;
    }

    .calendar-card {
        background: white;
        border-radius: 12px;
        padding: 32px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .calendar-title {
        font-size: 20px;
        font-weight: 600;
        color: #1a1a1a;
    }

    .month-nav {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .month-name {
        font-size: 16px;
        font-weight: 500;
        min-width: 140px;
        text-align: center;
        color: #333;
    }

    .nav-button {
        width: 32px;
        height: 32px;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: background 0.2s;
    }

    .nav-button:hover {
        background: #f5f5f5;
    }

    .legend-row {
        display: flex;
        gap: 24px;
        margin-bottom: 28px;
        font-size: 13px;
        color: #666;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .legend-dot.available {
        border: 2px solid #e0e0e0;
        background: white;
    }

    .legend-dot.blocked {
        background: #ffc0c0;
    }

    .legend-dot.occupied {
        background: #ff4444;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
    }

    .weekday-header {
        text-align: center;
        font-size: 12px;
        font-weight: 600;
        color: #999;
        padding: 8px 0;
        text-transform: uppercase;
    }

    .day-cell {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        border-radius: 50%;
        cursor: pointer;
        position: relative;
        transition: all 0.2s;
        font-weight: 500;
    }

    .day-cell.other-month {
        color: #ccc;
    }

    .day-cell.available {
        color: #333;
    }

    .day-cell.available:hover {
        background: #f8f8f8;
    }

    .day-cell.occupied {
        background: #ff4444;
        color: white;
    }

    .day-cell.blocked {
        background: #ffe0e0;
        color: #ff6b6b;
    }

    .day-cell.selected {
        background: #ffe0e0;
        color: #ff4444;
    }

    .details-card {
        background: white;
        border-radius: 12px;
        padding: 28px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        height: fit-content;
    }

    .details-header {
        margin-bottom: 24px;
    }

    .details-title {
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 4px;
    }

    .details-date {
        font-size: 14px;
        color: #666;
    }

    .event-section {
        margin-bottom: 20px;
    }

    .event-label {
        font-size: 13px;
        color: #999;
        margin-bottom: 8px;
        font-weight: 500;
    }

    .event-value {
        font-size: 15px;
        color: #333;
        line-height: 1.6;
    }

    .details-button {
        width: 100%;
        padding: 12px;
        background: #1a1a1a;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
        margin-top: 24px;
    }

    .details-button:hover {
        background: #333;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }

    .empty-state-icon {
        width: 64px;
        height: 64px;
        margin: 0 auto 16px;
        opacity: 0.3;
    }

    .sync-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        color: #333;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 24px;
    }

    .sync-button:hover {
        background: #f8f8f8;
        border-color: #ccc;
    }

    @media (max-width: 1024px) {
        .calendar-container {
            grid-template-columns: 1fr;
        }
    }
</style>


<div>
    <div style="background: #f7f7f7; min-height: 100vh; padding-top: 20px;">
        <!-- Page Header -->
        <div style="max-width: 1400px; margin: 0 auto; padding: 0 24px 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 style="font-size: 24px; font-weight: 600; color: #1a1a1a; margin: 0;">Agenda de Disponibilidad</h1>
                <button (click)="syncWithGoogleCalendar()" class="sync-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Sincronizar con Google Calendar
                </button>
            </div>
        </div>

        <!-- Main Calendar Grid -->
        <div class="calendar-container">
            <!-- Left: Calendar -->
            <div class="calendar-card">
                <!-- Calendar Header -->
                <div class="calendar-header">
                    <h2 class="calendar-title">Agenda de Disponibilidad</h2>
                    <div class="month-nav">
                        <button (click)="previousMonth()" class="nav-button">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <span class="month-name">{{ monthYear() }}</span>
                        <button (click)="nextMonth()" class="nav-button">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Legend -->
                <div class="legend-row">
                    <div class="legend-item">
                        <div class="legend-dot available"></div>
                        <span>Disponible</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot blocked"></div>
                        <span>Bloqueado</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot occupied"></div>
                        <span>Ocupado</span>
                    </div>
                </div>

                <!-- Calendar Grid -->
                <div class="calendar-grid">
                    <!-- Weekday Headers -->
                    @for (day of weekDays; track day) {
                    <div class="weekday-header">{{ day }}</div>
                    }

                    <!-- Calendar Days -->
                    @for (day of calendarDays(); track day.date.getTime()) {
                    <div (click)="selectDate(day)" class="day-cell" [class.other-month]="!day.isCurrentMonth"
                        [class.available]="day.state === 'available' && day.isCurrentMonth"
                        [class.occupied]="day.state === 'occupied'" [class.blocked]="day.state === 'blocked'"
                        [class.selected]="day.isSelected">
                        {{ day.dayNumber }}
                    </div>
                    }
                </div>
            </div>

            <!-- Right: Event Details -->
            <div class="details-card">
                <div class="details-header">
                    <h3 class="details-title">Detalles del Día</h3>
                    @if (selectedDate()) {
                    <p class="details-date">{{ formattedSelectedDate() }}</p>
                    }
                </div>

                @if (selectedDate()) {
                @if (eventsForSelectedDate().length > 0) {
                <!-- Has Events -->
                @for (event of eventsForSelectedDate(); track event.id) {
                <div>
                    <div class="event-section">
                        <div class="event-label">Hora</div>
                        <div class="event-value">{{ formatEventTime(event.fecha_servicio) }}</div>
                    </div>

                    <div class="event-section">
                        <div class="event-label">Evento de Areli y Carlos</div>
                        <div class="event-value">{{ event.titulo_evento || 'Evento sin título' }}</div>
                    </div>

                    <div class="event-section">
                        <div class="event-label">Ubicación</div>
                        <div class="event-value">{{ event.direccion_servicio || 'No especificada' }}</div>
                    </div>

                    <button (click)="viewRequestDetails(event.id)" class="details-button">
                        Ver Detalles Completos
                    </button>
                </div>
                }
                } @else {
                <!-- No Events - Available Day -->
                @for (day of calendarDays(); track day.date.getTime()) {
                @if (day.isSelected && day.state === 'available') {
                <div class="empty-state">
                    <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <p style="font-size: 14px; margin-bottom: 20px;">No hay eventos en esta fecha</p>
                    <button (click)="blockDateManually()" class="details-button">
                        Bloquear Fecha Manualmente
                    </button>
                </div>
                }
                @if (day.isSelected && day.state === 'blocked' && day.blockId) {
                <div class="empty-state">
                    <svg class="empty-state-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"
                            clip-rule="evenodd" />
                    </svg>
                    <p style="font-size: 14px; margin-bottom: 20px;">Esta fecha está bloqueada</p>
                    <button (click)="unblockDate(day.blockId!)" class="details-button"
                        style="background: white; color: #1a1a1a; border: 1px solid #e0e0e0;">
                        Desbloquear Fecha
                    </button>
                </div>
                }
                }
                }
                } @else {
                <!-- No Date Selected -->
                <div class="empty-state">
                    <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                    </svg>
                    <p style="font-size: 14px;">Selecciona un día del calendario para ver sus detalles</p>
                </div>
                }
            </div>
        </div>
    </div>
</div>