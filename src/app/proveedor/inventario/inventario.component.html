<div class="p-6 max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-slate-900">Gestión de Inventario</h1>
            <p class="text-slate-500 mt-1">Supervise y edite sus productos de FestEasy en tiempo real.</p>
        </div>
        <button pButton pRipple label="Agregar Producto" icon="pi pi-plus" (click)="abrirDialogo()"
            class="p-button-danger rounded-xl px-6 py-3 shadow-lg shadow-red-100 font-semibold">
        </button>
    </div>

    <!-- Filters Section -->
    <div class="flex items-center gap-2 mb-8 border-b border-slate-100 pb-1 overflow-x-auto">
        <button (click)="setFiltro('todos')"
            [class]="'px-4 py-2 text-sm font-medium transition-all whitespace-nowrap ' + (filtroActual() === 'todos' ? 'text-red-500 border-b-2 border-red-500' : 'text-slate-500 hover:text-slate-700')">
            Todos los productos
        </button>
        <button (click)="setFiltro('bajo')"
            [class]="'px-4 py-2 text-sm font-medium transition-all whitespace-nowrap ' + (filtroActual() === 'bajo' ? 'text-red-500 border-b-2 border-red-500' : 'text-slate-500 hover:text-slate-700')">
            Stock bajo
        </button>
        <button (click)="setFiltro('agotado')"
            [class]="'px-4 py-2 text-sm font-medium transition-all whitespace-nowrap ' + (filtroActual() === 'agotado' ? 'text-red-500 border-b-2 border-red-500' : 'text-slate-500 hover:text-slate-700')">
            Sin stock
        </button>
    </div>

    <!-- Main Content -->
    <div *ngIf="isLoading()" class="flex flex-col items-center justify-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-500"></div>
        <p class="text-slate-500 mt-4">Cargando inventario...</p>
    </div>

    <div *ngIf="!isLoading()" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <div *ngFor="let p of getProductosFiltrados()"
            class="bg-white rounded-3xl border border-slate-100 overflow-hidden hover:shadow-xl hover:shadow-slate-200/50 transition-all duration-300 group flex flex-col h-full">

            <!-- Image Area -->
            <div class="relative h-64 overflow-hidden">
                <img [src]="p.imagen_url || 'assets/placeholder-product.png'"
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                    [alt]="p.nombre">

                <!-- Stock Badge -->
                <div class="absolute top-4 right-4">
                    <span
                        [class]="'px-3 py-1 text-[10px] font-bold rounded-lg border ' + getEstadoStock(p.stock).class">
                        {{ getEstadoStock(p.stock).label }}
                    </span>
                </div>

                <!-- Featured Badge -->
                <div *ngIf="p.destacado" class="absolute top-4 left-4">
                    <span
                        class="bg-white/90 backdrop-blur-sm text-slate-900 px-3 py-1 text-[10px] font-bold rounded-lg border border-slate-100 shadow-sm flex items-center gap-1">
                        <span class="material-icons text-[12px] text-amber-500">star</span>
                        DESTACADO
                    </span>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-6 flex flex-col flex-grow">
                <div class="mb-4">
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{ p.categoria || 'SIN
                        CATEGORÍA' }}</span>
                    <h3 class="text-lg font-bold text-slate-900 mt-1 line-clamp-2 min-h-[3.5rem]">{{ p.nombre }}</h3>
                </div>

                <div class="flex items-center justify-between mb-6 pb-6 border-b border-slate-50">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Precio Unitario</p>
                        <p class="text-xl font-black text-slate-900">{{ p.precio_unitario | currency:'USD' }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Disponible</p>
                        <p [class]="'text-sm font-bold ' + (p.stock < 5 ? 'text-orange-500' : 'text-emerald-500')">
                            {{ p.stock }} en stock
                        </p>
                    </div>
                </div>

                <!-- Footer Buttons -->
                <div class="mt-auto flex gap-2">
                    <button pButton pRipple label="Editar" (click)="abrirDialogo(p)"
                        class="p-button-danger rounded-xl flex-grow font-semibold text-sm py-2">
                    </button>
                    <button pButton pRipple icon="pi pi-trash" (click)="eliminarProducto(p.id)"
                        class="p-button-text p-button-secondary rounded-xl font-semibold px-4 border border-slate-100 hover:bg-slate-50">
                    </button>
                    <button pButton pRipple [icon]="p.destacado ? 'pi pi-star-fill' : 'pi pi-star'"
                        (click)="toggleDestacado(p)"
                        [class]="'p-button-text rounded-xl font-semibold px-4 border border-slate-100 hover:bg-slate-50 ' + (p.destacado ? 'p-button-warning' : 'p-button-secondary')">
                    </button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="getProductosFiltrados().length === 0"
            class="col-span-full flex flex-col items-center justify-center py-20 bg-slate-50/50 rounded-3xl border-2 border-dashed border-slate-200">
            <span class="material-icons text-6xl text-slate-300 mb-4">inventory_2</span>
            <h3 class="text-xl font-bold text-slate-900">No hay productos encontrados</h3>
            <p class="text-slate-500 mt-2">Prueba cambiando el filtro o agrega un nuevo producto.</p>
        </div>
    </div>
</div>

<!-- Modal Form -->
<app-producto-form [visible]="mostrarDialogo()" [producto]="productoSeleccionado()"
    (onSave)="onProductoGuardado($event)" (onCancel)="cerrarDialogo()">
</app-producto-form>

<p-toast position="bottom-right"></p-toast>