<!-- Contenido Principal -->
<div class="min-h-screen bg-slate-50 text-slate-900 selection:bg-primary/10">
    <!-- Notificaciones Toast (Premium) -->
    @if (mensajeExito()) {
    <div
        class="fixed top-24 right-6 z-[100] bg-emerald-500 text-white px-8 py-4 rounded-2xl shadow-[0_20px_50px_rgba(16,185,129,0.3)] flex items-center gap-4 animate-in slide-in-from-right duration-500 backdrop-blur-md">
        <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
            <span class="material-icons-outlined text-2xl">check_circle</span>
        </div>
        <div class="flex flex-col">
            <span class="font-black text-sm uppercase tracking-widest">Éxito</span>
            <span class="text-xs opacity-90 font-medium">{{ mensajeExito() }}</span>
        </div>
    </div>
    }

    <!-- Custom Premium Styles -->
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
        }

        .card-stagger {
            animation: card-appear 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes card-appear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn-futuristic {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-futuristic::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: 0.5s;
        }

        .btn-futuristic:hover::after {
            left: 100%;
        }

        .futuristic-tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>

    <main class="w-full p-6 md:p-12 max-w-7xl mx-auto">
        <!-- Header & Stats Summary -->
        <div
            class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-8 mb-12 animate-in fade-in slide-in-from-top duration-700">
            <div>
                <h1 class="text-4xl md:text-6xl font-black tracking-tighter mb-2 text-slate-900">
                    Bandeja de Solicitudes
                </h1>
                <p class="text-slate-500 font-medium tracking-wide">Gestiona tus eventos y maximiza tu productividad.
                </p>
            </div>

            <div class="flex gap-4 w-full lg:w-auto overflow-x-auto pb-4 lg:pb-0">
                <div
                    class="glass-card px-8 py-5 rounded-[2rem] flex flex-col items-center justify-center min-w-[140px] border-l-4 border-l-amber-500 shadow-sm hover:shadow-md transition-shadow">
                    <span class="text-3xl font-black text-slate-900">{{ contadores().pendientes }}</span>
                    <span class="text-[10px] uppercase font-black tracking-[0.2em] text-slate-400 mt-1">Nuevas</span>
                </div>
                <div
                    class="glass-card px-8 py-5 rounded-[2rem] flex flex-col items-center justify-center min-w-[140px] border-l-4 border-l-emerald-500 shadow-sm hover:shadow-md transition-shadow">
                    <span class="text-3xl font-black text-emerald-600">{{ contadores().aceptadas }}</span>
                    <span class="text-[10px] uppercase font-black tracking-[0.2em] text-slate-400 mt-1">Activas</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs (Modern Light Pill Style) -->
        <nav
            class="flex items-center gap-2 p-1.5 bg-slate-200/50 backdrop-blur-md rounded-[2.5rem] w-fit mb-12 border border-slate-200 mx-auto shadow-inner">
            <button (click)="cambiarTab('pendientes')"
                [class]="tabActivo() === 'pendientes' ? 'bg-primary text-white shadow-lg' : 'text-slate-500 hover:text-slate-900'"
                class="futuristic-tab flex items-center gap-2 px-10 py-3.5 rounded-[2rem] font-bold text-xs uppercase tracking-widest transition-all">
                <span class="material-icons-outlined text-sm">inbox</span>
                Pendientes
            </button>
            <button (click)="cambiarTab('aceptadas')"
                [class]="tabActivo() === 'aceptadas' ? 'bg-emerald-500 text-white shadow-lg' : 'text-slate-500 hover:text-slate-900'"
                class="futuristic-tab flex items-center gap-2 px-10 py-3.5 rounded-[2rem] font-bold text-xs uppercase tracking-widest transition-all">
                <span class="material-icons-outlined text-sm">check_circle</span>
                Aceptadas
            </button>
            <button (click)="cambiarTab('historial')"
                [class]="tabActivo() === 'historial' ? 'bg-slate-700 text-white shadow-lg' : 'text-slate-500 hover:text-slate-900'"
                class="futuristic-tab flex items-center gap-2 px-10 py-3.5 rounded-[2rem] font-bold text-xs uppercase tracking-widest transition-all">
                <span class="material-icons-outlined text-sm">history</span>
                Historial
            </button>
        </nav>

        <!-- Main Content Area -->
        @if (isLoading()) {
        <div class="grid grid-cols-1 gap-8">
            @for (i of [1,2,3]; track i) {
            <div class="bg-white/80 h-56 rounded-[2.5rem] border border-slate-100 animate-pulse shadow-sm"></div>
            }
        </div>
        } @else {
        <div class="grid grid-cols-1 gap-8">
            @for (solicitud of solicitudesFiltradas(); track solicitud.id; let i = $index) {
            <p-card
                [styleClass]="'glass-card group relative mb-8 animate-in fade-in slide-in-from-bottom duration-500 fill-mode-both overflow-hidden card-stagger'"
                [style]="{'--index': i, 'animation-delay': (i * 100) + 'ms', 'border-radius': '2.5rem', 'background': 'rgba(255,255,255,0.9)', 'border': '1px solid rgba(0,0,0,0.05)', 'box-shadow': '0 10px 30px -10px rgba(0,0,0,0.08)'}">

                <div class="bg-white/40 -m-5 rounded-[2.2rem]">
                    <!-- Banner de Urgencia -->
                    @if (solicitud.estado === 'pendiente_aprobacion') {
                    <div [class]="solicitud.es_critico ? 'bg-rose-50 text-rose-600 border-rose-100' : 'bg-amber-50 text-amber-600 border-amber-100'"
                        class="px-8 py-3.5 flex items-center gap-3 text-[10px] font-black uppercase tracking-[0.2em] border-b">
                        <span class="w-2 h-2 rounded-full bg-current animate-pulse"></span>
                        <span>Tiempo para responder: {{ formatearTiempoRestante(solicitud.horas_restantes) }}</span>
                    </div>
                    }

                    <div class="p-8 md:p-10 flex flex-col md:flex-row gap-10">
                        <!-- Columna de Perfil -->
                        <div class="flex items-center gap-8 min-w-fit">
                            <div class="relative w-24 h-24 md:w-32 md:h-32">
                                <div
                                    class="absolute inset-0 bg-gradient-to-tr from-primary/20 to-emerald-400/20 rounded-[2rem] rotate-6 group-hover:rotate-12 transition-transform duration-700">
                                </div>
                                <div
                                    class="relative w-full h-full rounded-[2rem] bg-slate-100 flex items-center justify-center border border-white overflow-hidden shadow-sm">
                                    @if (solicitud.cliente_avatar) {
                                    <img [src]="solicitud.cliente_avatar" class="w-full h-full object-cover">
                                    } @else {
                                    <span class="text-4xl md:text-6xl font-black text-slate-300">{{
                                        solicitud.cliente_nombre.charAt(0)
                                        }}</span>
                                    }
                                </div>
                            </div>
                            <div class="flex flex-col gap-1.5">
                                <span
                                    class="text-[10px] font-black uppercase tracking-widest text-slate-400">Cliente</span>
                                <h3
                                    class="text-2xl md:text-4xl font-black text-slate-900 group-hover:text-primary transition-colors">
                                    {{ solicitud.cliente_nombre }}
                                </h3>
                                <div class="flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">{{
                                        solicitud.tipo_evento }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Detalles -->
                        <div
                            class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-8 items-center border-l border-slate-100 md:pl-10">
                            <div class="flex flex-col gap-1">
                                <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Servicio /
                                    Fecha</span>
                                <div class="flex items-center gap-2 text-slate-700 font-bold">
                                    <span class="material-icons-outlined text-sm opacity-30">event</span>
                                    <span class="text-base tracking-tight leading-tight">{{ solicitud.titulo_evento
                                        }}</span>
                                </div>
                                <div
                                    class="flex items-center gap-2 text-primary font-black text-[10px] uppercase tracking-widest mt-1">
                                    <span class="material-icons text-xs">calendar_today</span>
                                    {{ formatearFecha(solicitud.fecha_servicio) }}
                                </div>
                            </div>
                            <div class="flex flex-col gap-1 text-slate-600">
                                <span
                                    class="text-[10px] font-black uppercase tracking-widest text-slate-400">Ubicación</span>
                                <div class="flex items-center gap-2">
                                    <span class="material-icons-outlined text-sm opacity-30">location_on</span>
                                    <span class="text-xs md:text-sm font-medium line-clamp-1 italic text-slate-500">{{
                                        solicitud.direccion_servicio
                                        }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Precio y Acciones -->
                        <div class="flex flex-col items-start md:items-end justify-between min-w-[220px] gap-8">
                            <div class="text-left md:text-right w-full">
                                <span
                                    class="text-[10px] font-black uppercase tracking-widest text-slate-400 block mb-1">Presupuesto</span>
                                <span class="text-3xl md:text-5xl font-black text-slate-900 tracking-tighter">
                                    {{ solicitud.monto_total | currency }}
                                </span>
                            </div>

                            <div class="flex gap-4 w-full justify-end">
                                @if (solicitud.estado === 'pendiente_aprobacion') {
                                <button (click)="rechazarSolicitud(solicitud)"
                                    class="w-16 h-16 bg-rose-50 hover:bg-rose-100 text-rose-500 rounded-2xl transition-all border border-rose-100 flex items-center justify-center shadow-sm">
                                    <span class="material-icons text-2xl">close</span>
                                </button>
                                <button (click)="aceptarSolicitud(solicitud)"
                                    class="btn-futuristic flex-1 h-16 bg-primary text-white font-black text-xs uppercase tracking-widest rounded-2xl shadow-xl hover:shadow-primary/30 transition-all">
                                    Aceptar
                                </button>
                                } @else {
                                <div
                                    class="px-8 py-3.5 bg-slate-100 rounded-2xl border border-slate-200 flex items-center gap-3 text-[10px] font-black uppercase tracking-widest text-slate-600">
                                    <span class="w-2.5 h-2.5 rounded-full bg-slate-400 shadow-sm"></span>
                                    {{ solicitud.estado.replace('_', ' ') }}
                                </div>
                                <button [routerLink]="['/proveedor/solicitudes', solicitud.id]"
                                    class="w-16 h-16 bg-white hover:bg-slate-50 text-slate-900 rounded-2xl border border-slate-200 transition-all flex items-center justify-center shadow-sm">
                                    <span class="material-icons">chevron_right</span>
                                </button>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Footer Actions -->
                    @if (solicitud.estado === 'reservado') {
                    <div class="px-10 pb-10 pt-0">
                        <button (click)="esDiaDelEvento(solicitud.fecha_servicio) ? abrirModalPin(solicitud.id) : null"
                            [disabled]="!esDiaDelEvento(solicitud.fecha_servicio)" [class]="esDiaDelEvento(solicitud.fecha_servicio) 
                                        ? 'bg-rose-600 hover:bg-rose-700 shadow-xl shadow-rose-200' 
                                        : 'bg-slate-200 opacity-60 text-slate-500'"
                            class="w-full py-6 rounded-3xl flex items-center justify-center gap-4 font-black text-xs uppercase tracking-[0.2em] transition-all duration-500 border border-transparent text-white">
                            <span class="material-icons">vpn_key</span>
                            Validar PIN de Seguridad
                            @if (!esDiaDelEvento(solicitud.fecha_servicio)) {
                            <span
                                class="ml-2 py-1.5 px-4 bg-black/10 rounded-full text-[9px] tracking-widest uppercase">Activo
                                el día del evento</span>
                            }
                        </button>
                    </div>
                    }

                    @if (['rechazada', 'finalizado', 'cancelada', 'abandonada'].includes(solicitud.estado)) {
                    <div class="px-10 pb-10 flex justify-end">
                        <button (click)="eliminarDelHistorial(solicitud)"
                            class="text-rose-500/60 hover:text-rose-600 text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all p-2 rounded-lg hover:bg-rose-50">
                            <span class="material-icons text-base">delete</span>
                            Quitar del historial
                        </button>
                    </div>
                    }
                </div>

                <!-- Subtle Inner Glow -->
                <div
                    class="absolute inset-0 bg-gradient-to-tr from-primary/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                </div>
            </p-card>
            } @empty {
            <div
                class="bg-white rounded-[3.5rem] py-32 flex flex-col items-center justify-center text-center p-12 animate-in zoom-in duration-700 shadow-sm border border-slate-100">
                <div
                    class="w-32 h-32 rounded-full bg-slate-50 flex items-center justify-center border border-slate-100 mb-8 shadow-inner">
                    <span class="material-icons text-slate-300 text-[64px]">auto_stories</span>
                </div>
                <h2 class="text-3xl font-black text-slate-900 mb-2 tracking-tight">Nada por aquí</h2>
                <p class="text-slate-400 max-w-sm font-medium text-lg leading-relaxed">No se encontraron solicitudes en
                    esta categoría por el
                    momento.</p>
                <button (click)="cargarSolicitudes()"
                    class="mt-10 px-12 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-full text-[10px] font-black uppercase tracking-[0.2em] shadow-lg transition-all hover:-translate-y-1 active:scale-95">
                    Actualizar
                </button>
            </div>
            }
        </div>
        }
    </main>

    <!-- Componente de Validación de PIN -->
    @if (mostrarModalPin()) {
    <app-validar-pin [isOpen]="mostrarModalPin()" [solicitudId]="solicitudSeleccionada()"
        (closeModal)="cerrarModalPin()" (pinValidado)="onPinValidado($any($event))">
    </app-validar-pin>
    }

    <!-- Diálogo de Confirmación Global (Futuristic theme override) -->
    <p-confirmDialog [style]="{width: '450px'}" styleClass="futuristic-dialog" [baseZIndex]="10000"
        [closeOnEscape]="true" [draggable]="false">
    </p-confirmDialog>
</div>